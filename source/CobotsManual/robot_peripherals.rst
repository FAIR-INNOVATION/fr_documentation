机器人外设
=============

.. toctree:: 
  :maxdepth: 5

夹爪外设配置
-------------------

夹爪程序示教步骤
~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“末端外设配置”按钮，设备类型选择“夹爪设备”，夹爪的配置信息分为夹爪厂商、夹爪类型、软件版本和挂载位置，用户可根据具体的生产需求来配置相应的夹爪信息。若用户需要更改配置，可先选择相应的夹爪编号，点击“清除”按钮，来清除相应的按钮，并重新根据需求配置；

.. figure:: robot_peripherals/001.png
   :align: center
   :width: 3in

.. centered:: 图表 5.1‑1 夹爪配置

.. important:: 
	点击清除配置前，相应的夹爪应处于未激活状态。

**Step2**：夹爪配置完成后，用户可在页面下方的夹爪信息表中查看相应的夹爪信息，若发现配置错误，可点击“清除”按钮，重新配置夹爪；

.. figure:: robot_peripherals/002.png
   :align: center
   :width: 3in

.. centered:: 图表 5.1‑2 夹爪配置信息

**Step3**：选择配置完成的夹爪，点击“复位”按钮，页面弹出命令发送成功后，再点击“激活”按钮，可查看夹爪信息表中的激活状态，来判断是否激活成功；

.. important::
	激活夹爪时，夹爪不可有夹持物

**Step4**：程序示教命令界面中选择“Gripper”命令。在夹爪命令界面中，用户可以选择想要控制的夹爪编号（已经完成配置并且被激活的夹爪），设置相应的开闭状态、开闭速度、开闭力矩已经等待夹爪动作的最大时间。完成设置后点击添加应用即可。此外还可以添加夹爪激活和复位指令，以便于在运行程序时去激活/复位夹爪。

.. figure:: robot_peripherals/003.png
   :align: center
   :width: 3in

.. centered:: 图表 5.1‑3 夹爪指令编辑

夹爪程序示教
~~~~~~~~~~~~~~~

.. list-table:: 
   :widths: 15 40 100
   :header-rows: 1

   * - 序号
     - 指令格式
     - 注释
   * - 1
     - PTP(template2,100,-1,0)
     - #等待夹取点
   * - 2
     - PTP(template1,100,-1,0)
     - #夹取点
   * - 3
     - MoveGripper(1,255,255,0,1000,0)
     - #夹爪闭合
   * - 4
     - PTP(template2,100, -1,0)
     - /
   * - 5
     - PTP(template3,100, -1,0)
     - #等待放件点
   * - 6
     - PTP(template3,100, -1,0)
     - #放件点
   * - 7
     - MoveGripper(1,0,255,0,1000,0)
     - #夹爪开启

喷枪外设配置
-------------

喷枪外设配置步骤
~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“喷枪配置”按钮，用户可以通过喷涂功能一键配置按键，对喷涂所需DO进行快速配置（默认配置DO10为喷涂启停，DO11为喷涂清枪）。 用户也可以根据自己的需求在“IO配置”界面，自定义配置DO；

.. important:: 
	使用喷涂功能之前，需要先建立相应的工具坐标系，并在程序示教时应用建立好的工具坐标系。

**Step2**：配置完成后，点击“开始喷涂”、“停止喷涂”、“开始清枪”和“停止清枪”四个按钮，进行喷枪调试；

.. figure:: robot_peripherals/005.png
   :align: center
   :width: 3in

.. centered:: 图表 5.2‑1 喷枪配置

**Step3**：在程序示教命令界面选择“spray”命令。根据具体的程序示教需求，在相应的地方添加应用“开始喷涂”、“停止喷涂”、“开始清枪”和“停止清枪”四个指令。

.. figure:: robot_peripherals/006.png
   :align: center
   :width: 3in

.. centered:: 图表 5.2‑2 喷枪指令编辑

喷涂程序示教
~~~~~~~~~~~~~~

.. list-table:: 
   :widths: 15 40 100
   :header-rows: 1

   * - 序号
     - 指令格式
     - 注释
   * - 1
     - Lin(template1,100,-1,0,0)
     - #开始喷涂点
   * - 2
     - SprayStart()
     - #开始喷涂
   * - 3
     - Lin(template2,100,-1,0,0)
     - #喷涂路径
   * - 4
     - Lin(template3,100,-1,0,0)
     - #停止喷涂点
   * - 5
     - SprayStop()
     - #停止喷涂
   * - 6
     - Lin(template4,100,-1,0,0)
     - #清枪点
   * - 7
     - PowerCleanStart()
     - #开始清枪
   * - 8
     - WaitTime(5000)
     - #清枪时间 ms
   * - 9
     - PowerCleanStop()
     - #停止清枪

焊机外设配置
-------------

焊机外设配置步骤
~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“焊机配置”按钮，用户可以通过选择IO类型，选择“控制器I/O”配置焊机IO按键，对焊机所需DI和DO进行快速配置。默认配置如下：

.. list-table:: 
   :widths: 15 40
   :header-rows: 1
   :align: center

   * - IO信号
     - 功能

   * - DI12
     - 起弧成功信号

   * - DO9
     - 送气信号

   * - DO10
     - 起弧信号

   * - DO11
     - 点动送丝

   * - DO12
     - 反向送丝

   * - DO13
     - JOB选择1

   * - DO14
     - JOB选择2

   * - DO15
     - JOB选择3

用户也可以根据自己的需求在“IO配置”界面，自定义配置；或者选择“扩展I/O”后，配置扩展IO。

扩展配置IO：

- DI的“焊机准备”、“起弧成功”、“焊机中断恢复”和“焊机中断退出”；
- DO的“焊机起弧”、“气体检测”、“正向送丝”和“反向送丝”；

.. figure:: robot_peripherals/008.png
   :align: center
   :width: 3in

.. centered:: 图表 5.3‑1 IO配置（控制器IO）

.. figure:: robot_peripherals/065.png
   :align: center
   :width: 3in

.. centered:: 图表 5.3‑2 IO配置（扩展IO）

.. important:: 
	使用焊机功能之前，需要先建立相应的工具坐标系，并在程序示教时应用建立好的工具坐标系。焊机功能通常与激光跟踪传感器配合使用。

**Step2**：配置完成后，选择编号，设定等待时间，点击“收弧”、“起弧”、“送气”、“关气”、“正向送丝”和“反向送丝”六个按钮，进行焊机调试；

.. figure:: robot_peripherals/008.png
   :align: center
   :width: 3in

.. centered:: 图表 5.3‑3 焊机配置

**Step3**：在程序示教命令界面选择“Weld”命令。根据具体的程序示教需求，在相应的地方添加应用“起弧”、“收弧”、“关气”、“送气”、“停止正向送丝”、“正向送丝”、“停止反向送丝”和“反向送丝”指令。

.. figure:: robot_peripherals/009.png
   :align: center
   :width: 3in

.. centered:: 图表 5.3‑4 焊机指令编辑

焊机程序示教
~~~~~~~~~~~~~~~

.. list-table::
   :widths: 15 40 100
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - ARCEnd(0,0,10000)
     - 收弧

   * - 2
     - ARCStart(0,0,10000)
     - 起弧

   * - 3
     - SetAspirated(0,0)
     - 关气

   * - 4
     - SetAspirated(0,1)
     - 送气

   * - 5
     - SetForwardWireFeed(0,0)
     - 停止正向送丝

   * - 6
     - SetForwardWireFeed(0,1)
     - 正向送丝

   * - 7
     - SetReverseWireFeed(0,0)
     - 停止反向送丝

   * - 8
     - SetReverseWireFeed(0,1)
     - 反向送丝

电弧中断参数配置
~~~~~~~~~~~~~~~~~
电弧中断参数配置，可获取和设置电弧中断检测使能和确认时长。

焊接中断再恢复参数配置，可获取和设置焊接中断再重连使能、焊道重叠距离、从当前位置返回再起弧点速度和运行方式。

.. figure:: robot_peripherals/062.png
   :align: center
   :width: 3in

.. centered:: 图表 5.3‑5 电弧中断参数配置

当发生焊接中断，警告提示当前焊接已中断，可进行“退出中断”和“中断恢复”操作。

传感器外设配置
---------------

传感器外设配置步骤
~~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“传感器配置”按钮，本小节以机器人末端为例说明。

- 用户首先对最大差值进行设置，传感器扫描偏差点数最大差值建议默认设置为4，数据处理根据实际使用场景选择原始数据或者YZ数据。
- 控制器IP默认为192.168.57.2，传感器IP配置为同一网段即可，端口为5020，采样周期建议值25，通信协议目前适配为睿牛、创想和全视的通信协议，加载对应协议即可。
- 加载完成后，可通过“打开传感器”和“关闭传感器”按键测试传感器。

.. figure:: robot_peripherals/011.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑1 激光跟踪传感器IP配置

.. important:: 
	1. 使用传感器功能之前，需要先建立相应的工具坐标系，并在程序示教时应用建立好的工具坐标系。焊机功能通常与传感器配合使用。
	2. 传感器最大差值即为激光扫描焊缝位置上一时刻与当前时刻的最大偏差，范围为[0~10],单位为mm，推荐值为4。

**Step2**：标定传感器参考点。

在工具坐标系设置功能中，我们标定传感器类型工具，使用六点法配置传感器坐标系。

- 在机器人工作空间中选择一个固定的点，将传感器中心点从三个不同的角度移至所选点上，分别设置点1，2，3。
- 将传感器中心点垂直移至所选点正上方，记录点4。
- 将传感器中心点由固定点移至传感器坐标系的X轴方向上一点，设置点5。
- 回到固定点，垂直向上移动，将传感器中心点由固定点移至传感器坐标系的Z轴方向上一点，设置为点6。
- 点击计算，得到传感器工具的位姿，点击应用，即可完成。如不想应用结果，点击“取消”按钮重新标定。

.. figure:: robot_peripherals/012.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑2 参考点配置-六点法

**八点法**：在工具坐标系设置功能中，我们标定传感器类型工具，使用八点法配置传感器坐标系，选择八点法。

- 移动传感器激光线使其与标定板上的标定线重合，尽量使得传感器与标定线保持较近距离且识别到标定点，记录点1；
- 移动-y/+y方向20mm左右,调整机器人使激光识别到标定点，记录点2；
- 移动-x/+x方向20mm左右，调整机器人使激光识别到标定点，记录点3；
- 移动-y/+y方向20mm左右，调整机器人使激光识别到标定点，记录点4；
- 移动-rx方向5mm左右，调整机器人使激光识别到标定点，记录点5；
- 移动-ry方向5mm左右，调整机器人使激光识别到标定点，记录点6；
- 移动-rz方向5mm左右，调整机器人使传感器识别到标定点，记录点7；
- 移动-rz方向5mm左右，调整机器人使激光识别到标定点，记录点8；
- 点击计算，得到传感器位姿，点击应用，即可完成。如不想应用结果，点击“取消”按钮重新标定。

.. figure:: robot_peripherals/013.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑3 参考点配置-八点法

**五点法**：在工具坐标系设置功能中，我们标定传感器类型工具，使用五点法配置传感器坐标系。

- 首先确定一个固定点，将工具末端对准该点，记录点1，标定成功后记录当前点位的传感器输出值;
- 接着调整机器人姿态，使得激光识别到记录的固定点，分别记录点2至点5，注意姿态变化需要尽可能大;
- 点击计算，得到传感器位姿和精度，根据精度觉得是否应用。如需应用结果，点击“应用”按钮，即可完成。如觉得精度不符合预期，点击“取消”按钮重新标定。

.. figure:: robot_peripherals/014.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑4 参考点配置-五点法

.. figure:: robot_peripherals/071.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑5 五点法-传感器输出值

.. figure:: robot_peripherals/072.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑6 五点法-精度

激光传感器跟踪功能
~~~~~~~~~~~~~~~~~~~

指令说明：在程序示教命令界面选择“Laser”命令。里面集成了激光的相关指令，根据具体的程序示教需求，在相应的地方添加指令，参考下方的程序示例。

.. figure:: robot_peripherals/015.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑5 激光跟踪指令编辑

程序示例：

.. list-table:: 
   :widths: 15 40 100
   :header-rows: 1

   * - 序号
     - 指令格式
     - 注释
   * - 1
     - LTLaserOn(2)
     - #打开传感器
   * - 2
     - PTP(template1,100,-1,0)
     - #传感器起始点
   * - 3
     - LTSearchStart(1,20,100,10000,2)
     - #开始寻位
   * - 4
     - LTSearchStop()
     - #停止寻位
   * - 5
     - Lin(seamPos,20,-1,0,0,0)
     - #焊缝起点
   * - 6
     - LTTrackOn(2)
     - #激光跟踪
   * - 7
     - ARCStart(0,10000)
     - #焊机起弧
   * - 8
     - Lin(SeamEnd11,10-1,0,0)
     - #焊缝终点
   * - 9
     - ARCEnd(0,10000)
     - #焊机收弧
   * - 10
     - LTTrackOff()
     - #传感器跟踪关闭
   * - 11
     - LTLaserOff()
     - #关闭传感器

激光传感器轨迹复现功能
~~~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：在程序示教命令界面选择“LT-Rec”命令。该指令主要用于激光识别路径起点终点获取以及轨迹复现，根据具体的程序示教需求，在相应的地方添加指令，参考下方的程序示例。

.. figure:: robot_peripherals/017.png
   :align: center
   :width: 3in

.. centered:: 图表 5.4‑6 轨迹复现指令编辑

程序示例：

.. list-table:: 
   :widths: 15 40 100
   :header-rows: 1

   * - 序号
     - 指令格式
     - 注释
   * - 1
     - PTP(template1,100,-1,0)
     - #运动至起点
   * - 2
     - LaserSensorRecord(2,0,30)
     - #传感器开始记录
   * - 3
     - Lin(template2,100,-1,0,0)
     - #运动至终点
   * - 4
     - LaserSensorRecord(0,0,30)
     - #停止记录
   * - 5
     - pos={}
     - #初始化数组
   * - 6
     - pos=GetWeldTrackingRecordStartPos(0,30)
     - #获取激光记录的起点
   * - 7
     - If type(pos) == “table” then
     - #判断数据类型
   * - 8
     - LaserPTP(#pos,pos)
     - #运动至激光轨迹起点
   * - 9
     - end
     - /
   * - 10
     - LaserSensorRecord(3,0,30)
     - #设置复现轨迹
   * - 11
     - MoveLTR()
     - #开始复现轨迹
   * - 12
     - LaserSensorRecord(0,0,30)
     - #结束

扩展轴外设配置
----------------

在用户外设配置界面中选择“扩展轴”按钮，进入扩展轴界面，选择组合方式进行对应的扩展轴外设配置。组合方式分为：控制器+PLC（UDP）和控制器+伺服驱动器（485）。

控制器+PLC（UDP）
~~~~~~~~~~~~~~~~~~~~

配置步骤
++++++++++++++++

**Step1**：首先对扩展轴UDP通信进行配置。设置IP地址、端口号、通信周期、丢包检测周期、丢包次数等参数，其中重连周期和重连次数需在通讯中断自动重连开关开启后才可配置。

- IP地址：自定义ip地址
- 端口号：根据实际情况定义
- 通讯周期：根据实际情况定义，单位ms
- 丢包检测通讯周期：10 ~ 1000 ms
- 丢包次数：1 ~ 100
- 通讯中断确认时长：0 ~ 500 ms
- 通讯中断自动重连：开/关
- 重连周期：1 ~ 1000 ms
- 重连次数：1 ~ 100

.. figure:: robot_peripherals/021.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑1 扩展轴通信配置

.. important:: 
  1. 设置通讯断开确认时长后，当通讯异常超出该时长时才确认通讯断开并报错 
  2. UDP通讯断开后，触发UDP断开报错(可复位)，可点击清除警告信息按钮，UDP通讯再次建立。

**Step2**：选择扩展轴编号1，点击“参数配置”按键进入右侧界面。设置轴类型，轴方向，运行速度，加速度，正方向限位，反方向限位，导程，编码器分辨率，起点偏置，厂家，型号和模式，点击配置即可配置完成。

.. figure:: robot_peripherals/019.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5-2 扩展轴参数配置
	
.. important:: 
	使用扩展轴功能之前，需要先建立相应的扩展轴标系，并在程序示教时应用建立好的工具坐标系。扩展轴功能主要与焊机功能和激光跟踪传感器功能配合使用。

**Step3**：使点击“零点设置”按键进入零点设置弹窗，如右侧图片所示。设定回零方式，寻零速度，零点箍位速度和轴方向，点击“设置”按键，扩展轴开始回零，回零状态会显示在轴方向下方空白处，当出现“回零已完成”提示表明扩展轴零点设置成功。

.. figure:: robot_peripherals/020.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑3 扩展轴零点设置

**Step4**：选择已经配置好参数的扩展轴编号，点击“伺服使能”后，设置运行速度，加速度和单次运行最大距离，可以进行正向转动和反向转动测试扩展轴。

.. figure:: robot_peripherals/021.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑4 扩展轴测试

**Step5**：扩展轴通常于激光传感器配合使用，此时激光传感器通常采用外部安装方式，传感器参考点配置需要采用三点法标定，而不是之前使用的六点法标定。将工具中心对准右侧横截面底部中间点（靠近相机那一侧）设定点1，将工具中心点对准另一截面即左侧横截面底部中间点，设定点2，将工具中心点移至传感器右侧横截面上边缘中间点，设定点3，计算并保存，点击应用完成三点法标定。

.. figure:: robot_peripherals/022.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑5 传感器三点法标定

**Step6**：在程序示教命令界面选择“EAxis”命令。根据具体的程序示教需求，在相应的地方添加指令。

.. figure:: robot_peripherals/023.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑6 扩展轴指令编辑

控制器+伺服驱动器（485）
~~~~~~~~~~~~~~~~~~~~~~~~~~

**Step1**：首先对伺服驱动器参数进行配置。设置伺服驱动器编号、伺服驱动器厂商、伺服驱动器型号、伺服驱动器软件版本、编码器分辨率和机械传动比。点击“清除”按钮清空当前伺服驱动器编号的配置。配置成功后获取伺服驱动器配置列表数据。

.. figure:: robot_peripherals/069.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑7 配置伺服驱动器参数

**Step2**：进行伺服驱动器调试前，务必先设置伺服驱动器编号，设置成功后进行控制模式设置。设置回零方式、寻零速度和零点箍位速度。选择“位置模式”时，设置“目标位置”和“运行速度”；选择“速度模式”设置“目标速度”。

.. important::
   设置控制模式前，若伺服已使能，请先去使能，否则设置无法生效。

.. figure:: robot_peripherals/067.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑8 伺服驱动器调试

**Step3**：在程序示教命令界面选择“扩展轴”命令。根据具体的程序示教需求，在相应的地方添加指令。

.. figure:: robot_peripherals/068.png
   :align: center
   :width: 3in

.. centered:: 图表 5.5‑9 扩展轴指令编辑

扩展轴配合激光跟踪焊接示教程序
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - EXT_AXIS_PTP(1,1laserstart)
     - #外部轴运动激光传感器起始点

   * - 2
     - PTP(laserstart,10,-1,0)
     - #机器人运动激光传感器起始点

   * - 3
     - LTSearchStart(3,20,10,10000)
     - #开始寻位

   * - 4
     - LTSearchStop()
     - #停止寻位

   * - 5
     - EXT_AXIS_PTP(1,1,seamPos)
     - #外部轴运动焊缝起点

   * - 6
     - Lin(seamPos,20,-1,00,0)
     - #机器人运动焊缝起点

   * - 7
     - LTTrackOn()
     - #激光跟踪

   * - 8
     - ARCStart(0,10000)
     - #焊机起弧

   * - 9
     - EXT_AXIS_PTP(1,1,laserend)
     - #外部轴运动焊缝终点

   * - 10
     - Lin( laserend,10,-1,0,0)
     - #机器人运动焊缝终点

   * - 11
     - ARCEnd(0,10000)
     - #焊机收弧

   * - 12
     - LTTrackOff
     - #激光跟踪关闭

传送带跟踪配置
-----------------

传送带跟踪配置步骤
~~~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“传送带跟踪”按钮，进入传送带跟踪配置界面，点击“配置传送带IO”按键快速配置传送带功能所需IO，之后根据实际使用功能情况配置对应的参数，此处以无视觉跟踪抓取功能为例，需要配置传送带编码器通道，分辨率，导程，视觉搭配选择否，点击配置。

.. figure:: robot_peripherals/025.png
   :align: center
   :width: 3in

.. centered:: 图表 5.6‑1 传送带配置

**Step2**：接下来设置抓取点补偿值，为X,Y,Z三个方向上的补偿距离，可在调试过程中根据实际情况设置。

.. figure:: robot_peripherals/026.png
   :align: center
   :width: 3in

.. centered:: 图表 5.6‑2 传送带抓取点补偿配置

**Step3**：开启传送带，将标定的物体移动到定义的A点位置，停止传送带。移动机器人，将机器人末端的标定杆尖点与所标定的物体尖点对齐，点击起始点A按键，跳出对话框，显示当前编码器值和机器人位姿，点击标定完成起始点A标定。

.. figure:: robot_peripherals/027.png
   :align: center
   :width: 3in

.. centered:: 图表 5.6‑3 起始点A配置

**Step4**：点击参考点按键，进入参考点标定，记录参考点时记录机器人抓取时的高度和姿态，每次跟踪时都会以记录参考点的高度和姿态区跟踪抓取，可以和AB点不在一个高度，点击标定完成参考点标定。

.. figure:: robot_peripherals/028.png
   :align: center
   :width: 3in

.. centered:: 图表 5.6‑4 参考点配置

**Step5**：开启传送带，将标定的物体移动到定义的B点位置，停止传送带。移动机器人，将机器人末端的标定杆尖点与所标定的物体尖点对齐，点击终点B按键，弹出对话框，显示当前编码器值和机器人位姿，点击标定完成终点B标定。

.. figure:: robot_peripherals/029.png
   :align: center
   :width: 3in

.. centered:: 图表 5.6‑5 终点B配置

传送带跟踪示教程序
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - PTP(conveyorstart,30,-1,0)
     - #机器人抓取起点

   * - 2
     - While(1) do
     - #循环抓取

   * - 3
     - ConveyorlODetect(10000)
     - #Io实时检测物体

   * - 4
     - ConveyorGetTrackData(1)
     - #物体位置获取

   * - 5
     - ConveyorTrackStart(1)
     - #传送带跟踪开始

   * - 6
     - Lin(cvrCatchPoint,10,-1,0,0)
     - #机器人到达抓取点

   * - 7
     - MoveGripper(1,255,255,0,10000)
     - #夹爪抓取物体

   * - 8
     - Lin(cvrRaisePoint,10,-1,0,0)
     - #机器人提起

   * - 9
     - ConveyorTrackEnd()
     - #传送带跟踪结束

   * - 10
     - PTP(conveyorraise,30,-1,0)
     - #机器人到达等待点

   * - 11
     - PTP(conveyorend,30,-1,0)
     - #机器人到达放置点

   * - 12
     - MoveGripper(1,0,255,0,10000)
     - #夹爪松开

   * - 13
     - PTP(conveyorstart,50,-1,0)
     - #机器人再次回到抓取起点,等待下次抓取

   * - 14
     - end
     - #结束

姿态自适应配置
----------------

姿态自适应配置步骤
~~~~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“跟踪姿态配置”按钮，进入姿态调整配置界面，选择板材类型和机器人实际工作运动方向，调整机器人姿态，分别设置姿态点A，姿态点B和姿态点C，通常A为平面姿态点，B为上升沿姿态点，C为下降沿姿态点。

.. figure:: robot_peripherals/031.png
   :align: center
   :width: 3in

.. centered:: 图表 5.7‑1 姿态调整配置

.. important:: 
	A姿态和B姿态，A姿态和C姿态之间的姿态变化在满足应用需求下姿态变化越小越好。姿态自适应功能为辅助应用功能，通常配合焊缝跟踪使用。

**Step2**：在程序示教命令界面选择“Adjust”命令。根据具体的程序示教需求，在相应的地方添加指令。

.. figure:: robot_peripherals/032.png
   :align: center
   :width: 3in

.. centered:: 图表 5.7‑2 姿态调整指令编辑

姿态自适应配合扩展轴和激光跟踪焊接示教程序
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - EXT_AXIS_PTP(1,1laserstart)
     - #外部轴运动激光传感器起始点

   * - 2
     - PTP(laserstart,10,-1,0)
     - #机器人运动激光传感器起始点

   * - 3
     - LTSearchStart(3,20,10,10000)
     - #开始寻位

   * - 4
     - LTSearchStop()
     - #停止寻位

   * - 5
     - EXT_AXIS_PTP(1,1,seamPos)
     - #外部轴运动焊缝起点

   * - 6
     - Lin(seamPos,20,-1,00,0)
     - #机器人运动焊缝起点

   * - 7
     - LTTrackOn()
     - #激光跟踪

   * - 8
     - ARCStart(0,10000)
     - #焊机起弧

   * - 9
     - PostureAdjustOn(0,PosA,PosC,PosB,1000)
     - #姿态自适应调整开启

   * - 10
     - EXT_AXIS_PTP(1,1,laserend)
     - #外部轴运动焊缝终点

   * - 11
     - Lin( laserend,10,-1,0,0)
     - #机器人运动焊缝终点

   * - 12
     - ARCEnd(0,10000)
     - #焊机收弧

   * - 13
     - PostureAdjustOff(0)
     - #姿态自适应调整关闭

   * - 14
     - LTTrackOff
     - #激光跟踪关闭

力/扭矩传感器外设配置
-------------------------

力/扭矩传感器配置步骤
~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“末端外设配置”按钮，设备类型选择“力传感器设备”，力传感器配置信息分为厂商、类型、软件版本和挂载位置，用户可根据具体的生产需求来配置相应的力传感器信息。若用户需要更改配置，可先选择相应的编号，点击“清除”按钮，来清除相应的信息，并重新根据需求配置；

.. figure:: robot_peripherals/034.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑1 力/矩传感器配置

.. important:: 
	点击清除配置前，相应的传感器应处于未激活状态。

**Step2**：力传感器配置完成后，用户可在页面下方的信息表中查看相应的力传感器信息，若发现配置错误，可点击“清除”按钮，重新配置。

.. figure:: robot_peripherals/035.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑2 力/矩传感器配置信息

**Step3**：选择配置完成的力传感器编号，点击“复位”按钮，页面弹出命令发送成功后，再点击“激活”按钮，可查看力传感器信息表中的激活状态，来判断是否激活成功；此外，力传感器会有初始值，用户根据使用需求选择“零点矫正”和“去除零点”。力传感器零点矫正需要确保力传感器水平垂直向下，且机器人未配置负载。

**Step4**：力传感器配置完成后，需要配置传感器类型工具坐标系，可根据传感器与末端工具中心的距离直接输入传感器工具坐标系值并应用。

力/扭矩传感器负载辨识
~~~~~~~~~~~~~~~~~~~~~~~~

在机器人配置界面中选择“力/扭矩传感器负载”进行配置。

特定姿态辨识：清除末端负载数据，配置好力传感器后，建立传感器坐标系，将机器人末端姿态调整为垂直向下，进行“零点矫正”后安装末端负载。首先选择对应传感器工具坐标系，调整机器人，使得传感器及工具垂直向下，记录数据，计算质量。接着，调整机器人3个不同姿态，分别记录三组数据，计算出质心，确认无误后点击应用。

**动态辨识**：清除末端负载数据，配置好力传感器后，建立传感器坐标系，将机器人末端姿态调整为垂直向下，进行“零点矫正”后安装末端负载。点击“辨识开启”，拖动机器人进行运动，接着点击“辨识关闭”，即可自动将负载结果应用到机器人中。

**自动校零**：传感器记录初始位置后，可自动校零。

.. figure:: robot_peripherals/036.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑3 力/扭矩传感器负载辨识

力/扭矩传感器辅助拖动
~~~~~~~~~~~~~~~~~~~~~~~

配置好传感器后，可以搭配传感器对拖动机器人进行更好的辅助。第一次使用时可以按照右侧图片的数据进行配置，应用完成后，此时无需进入拖动模式，直接对末端力传感器进行拖拽，即可控制机器人在固定姿态进行移动。（如下图中的数据为参考标准）

.. figure:: robot_peripherals/037.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑4 力/扭矩传感器拖动锁定

**自适应选择**：在需要装配时开启，开启后拖动变重；

**惯性参数**：调节拖动过程中的手感，最小值为0，需在技术人员指导下谨慎操作。

**阻尼参数**：

-  平动方向：建议设置参数在[100-200]之间；

-  转动方向：建议设置参数在[3-10]之间，其中RZ方向设置范围在[0.1-5]；

-  效果：借助传感器拖动时，增大阻尼会导致拖动困难，减小阻尼会导致拖动机器人过于轻松（建议不要太小）；

-  阻尼参数整体范围：平动XYZ：[100-1000]；转动RX、RY：[3-50],RZ:[2-10]；

-  最大拖动力为50，最大拖动速度为180。

**刚度参数**：均设为0；

**拖动力阈值**：平动XYZ为[5-10]；转动RX、RY、RZ为[0.5-5]；

.. important:: 
   通过加大平动方向XYZ或转动方向RX、RY、RZ的力阈值来实现锁定的方式。

力/扭矩传感器碰撞检测
~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_Guard”指令为碰撞检测指令。选择对应的传感器坐标系，勾选生效的力矩方向检测，设置当前值，碰撞最大阈值和碰撞最小阈值三项，碰撞检测条件正常范围为（当前值-最小阈值，当前值+最大阈值），将“开启”和“关闭”指令加入到程序中在。

.. figure:: robot_peripherals/038.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑5 FT_Guard指令编辑

程序示例：

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - FT_Guard(1,1,1,1,1,0,0,0,5,0,0,0,0,0,10,0,0,0,0,0,5,0,0,0,0,0)
     - #力/矩碰撞检测开启

   * - 2
     - PTP(template1,100,-1,0)
     - #运动指令

   * - 3
     - FT_Guard(0,1,1,1,1,0,0,0,5,0,0,0,0,0,10,0,0,0,0,0,5,0,0,0,0,0)
     - #力/矩碰撞检测关闭

力/扭矩传感器力控运动
~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_Control”指令为力控运动指令，可以使机器人在设定力的附近运动，常用于打磨场景中。选择对应的传感器坐标系，勾选生效的力矩方向检测，设置检测阈值，以及各个方向上PID比例系数(一般设置p为0.001)，设置最大调整距离（对应X,Y,Z）和最大调整角度（对应RX,RY,RZ），将“开启”和“关闭”指令加入到程序中在。

.. figure:: robot_peripherals/040.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑6 FT_Control指令编辑

程序示例：

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - FT_Control(1,11,1,0,1,0,0,0,10,0,5,0,0,0,0.001,0,0,0,0,0,0,0,0,10,5)
     - #力/矩运动控制开启

   * - 2
     - Lin(template3,100,-1,0,0)
     - #运动指令

   * - 3
     - FT_Control(0,11,1,0,1,0,0,0,10,0,5,0,0,0,0.001,0,0,0,0,0,0,0,10,5)
     - #力/矩运动控制关闭

力/扭矩传感器螺旋插入
~~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_Spiral”指令为螺旋线探索插入，一般用于圆柱轴的轴孔装配动作。在运行动作之前，需要将机器人末端拖动至孔位的大致位置，根据当前场景，设定指令的参数，添加到程序中，运行后，机器人会以螺旋形的运动进行探索。

.. figure:: robot_peripherals/042.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑7 FT_Spiral指令编辑

程序示例：

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - FT_Control(1,10,0,0,1,0,0,0,0,0,5,0,0,0,0.0005,0,0,0,0,0,0,10,0)
     - #力/矩运动控制开启

   * - 2
     - FT_SpiralSearch(0,0.7,0,60000,5)
     - #螺旋插入

   * - 3
     - FT_Control(0,10,0,0,1,0,0,0,0,0,5,0,0,0,0.0005,0,0,0,0,0,0,10,0)
     - #力/矩运动控制关闭

力/扭矩传感器旋转插入
~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_Rot”指令为旋转探索插入，一般用于承接螺旋线插入动作，用于键轴的轴孔装配。在运行动作之前，需要将机器人末端移动至螺旋线探索找到的孔位或者完全对齐的示教孔位，根据当前场景，设定指令的参数，添加到程序中，运行后，机器人会以缓慢的旋转进行探索。

.. figure:: robot_peripherals/044.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑8 FT_Rot指令编辑

程序示例：

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - FT_Control(1,10,0,0,1,0,0,0,0,0,5,0,0,0,0.0005,0,0,0,0,0,0,10,0)
     - #力/矩运动控制开启

   * - 2
     - FT_RotInsertion(0,3,0,5,1,0,1)
     - #旋转插入

   * - 3
     - FT_Control(0,10,0,0,1,0,0,0,0,0,5,0,0,0,0.0005,0,0,0,0,0,0,10,0)
     - #力/矩运动控制关闭

力/扭矩传感器直线插入
~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_Lin”指令为旋转探索插入，一般用于承接螺旋线插入动作或旋转插入动作，用于键轴的轴孔装配。在运行动作之前，需要将机器人末端移动至螺旋线探索找到的孔位，旋转插入动作结束的位置或者完全对齐的示教孔位，根据当前场景，设定指令的参数，添加到程序中，运行后，机器人会以设定的方向进行直线运动。

.. figure:: robot_peripherals/046.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑9 FT_Lin指令编辑

程序示例：

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - FT_Control(1,10,0,0,1,0,0,0,0,0,5,0,0,0,0.0005,0,0,0,0,0,0,10,0)
     - #力/矩运动控制开启

   * - 2
     - FT LinInsertion(0,50,1,0,100,1)
     - #直线插入

   * - 3
     - FT_Control(0,10,0,0,1,0,0,0,0,0,5,0,0,0,0.0005,0,0,0,0,0,0,10,0)
     - #力/矩运动控制关闭

力/扭矩传感器表面定位
~~~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_FindSurface”指令为表面定位，一般用于寻找物体表面。根据当前场景，设置对应坐标系，移动方向、移动轴、探索直线速度、探索直线加速度、最大探索距离、动作终止力阈值等参数，添加到程序中，运行程序，动作开始执行，机器人末端开始缓慢向表面所在方向移动。

.. figure:: robot_peripherals/048.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑10 FT_FindSurface指令编辑

程序示例：

.. list-table::
   :widths: 50 80 80
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - PTP(1,30,-1,0)
     - #初始位置

   * - 2
     - FT FindSurface(0,1,3,1,0,100,5)
     - #平面定位

力/扭矩传感器中心定位
~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_CalCenter”指令为中心定位，一般用于寻找两表面的中间平面表面。根据当前场景，设置对应坐标系，移动方向、移动轴、探索直线速度、探索直线加速度、最大探索距离、动作终止力阈值等参数，分别寻找A平面和B平面，添加到程序中，运行程序，动作开始执行，机器人缓慢向表面A所在方向移动，定位到A面后，机器人缓慢向表面B所在方向移动，定位到B面后，即可算出中心平面位置。

.. figure:: robot_peripherals/050.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑11 FT_CalCenter指令编辑

程序示例：

.. list-table::
   :widths: 20 40 50
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - PTP(1,30,-1,0)
     - #初始位置

   * - 2
     - FT_CalCenterStart()
     - #表面定位开始

   * - 3
     - FT_Control(1,10,0,0,1,0,0,0,0,0,-10,0,0,0,0.00001,0,0,0,0,0,0,100,0)
     - #力/矩运动控制开启

   * - 4
     - FT_FindSurface(1,2,2,10,0,200,5)
     - #定位平面A

   * - 5
     - FT_Control(0,10,0,0,1,0,0,0,0,0,-10,0,0,0,0.00001,0,0,0,0,0,0,100,0)
     - #力/矩运动控制关闭

   * - 6
     - PTP(1,30,-1,0)
     - #初始位置

   * - 7
     - FT_Control(1,10,0,0,1,0,0,0,0,0,-10,0,0,0,0.00001,0,0,0,0,0,0,100,0)
     - #力/矩运动控制开启
     
   * - 8
     - FT FindSurface(1,1,2,20,0,200,5)
     - #定位平面B

   * - 9
     - FT_Control(0,10,0,0,1,0,0,0,0,0,10,0,0,0,0.00001,0,0,0,0,0,0,100,0)
     - #力/矩运动控制关闭

   * - 10
     - pos={}
     - #定义数组pos

   * - 11
     - pos = FT_CalCenterEnd()
     - #获取定位中心笛卡尔位姿

   * - 12
     - MoveCart(pos,GetActualTCPNum(),GetActualWObjNum(),30,10,100,-1,0)
     - #运动至定位的中心位置

力/扭矩传感器点按力探测
~~~~~~~~~~~~~~~~~~~~~~~~~~~

指令说明：“FT_Click”指令为点按力探测，点按力探测用于探测一个点按力，通常和表面定位动作配合使用。设置好参数后，添加到程序中，运行程序，末端开始沿工具坐标系Z方向向目标移动，当Z正方向上的力达到点按力数值，则点按力探测完成。

.. figure:: robot_peripherals/052.png
   :align: center
   :width: 3in

.. centered:: 图表 5.8‑12 FT_Click指令编辑

程序示例：

.. list-table::
   :widths: 20 40 50
   :header-rows: 0
   :align: center

   * - **序号**
     - **指令格式**
     - **注释**

   * - 1
     - PTP(1,30,-1,0)
     - #初始位置

   * - 2
     - FT_Click(0,5,5,0,100,0)
     - #点按力探测

扩展IO设备外设配置
------------------------

扩展IO设备配置步骤
~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“末端外设配置”按钮，设备类型选择“扩展IO设备”，扩展IO设备配置信息分为厂商、类型、软件版本和挂载位置，用户可根据具体的生产需求来配置相应的设备信息。若用户需要更改配置，可先选择相应的编号，点击“清除”按钮，来清除相应的信息，并重新根据需求配置；

.. figure:: robot_peripherals/054.png
   :align: center
   :width: 3in

.. centered:: 图表 5.9‑1 扩展IO设备配置

.. important:: 
	点击清除配置前，相应的设备应处于未激活状态。

**Step2**：扩展IO设备配置完成后，用户可在辅助应用中点击“Smart Tool”功能菜单，进入此功能配置页面，用户可以对末端手柄上的各个按键功能进行自定义，包括（新建程序，保持程序，PTP，Lin，ARC，摆焊开始，摆焊结束，IO端口）。

.. figure:: robot_peripherals/055.png
   :align: center
   :width: 3in

.. centered:: 图表 5.9‑2 扩展IO设备功能配置

码垛系统配置
---------------

码垛系统配置步骤
~~~~~~~~~~~~~~~~~~~~~~

**Step1**：在用户外设配置界面中选择“码垛系统配置”按钮，第一次使用，需要首先进行配方创建，点击“配方创建”，输入配方名称，点击“创建”，创建成功后点击“开始配置”进入码垛配置页面。

.. figure:: robot_peripherals/056.png
   :align: center
   :width: 6in

.. centered:: 图表 5.10‑1 码垛配方配置

**Step2**：在工件配置栏中点击“配置”进入工件配置弹窗，设置工件的“长度”，“宽度”，“高度”以及工件的抓取点，点击“确认配置”完成工件信息设置。

.. figure:: robot_peripherals/057.png
   :align: center
   :width: 3in

.. centered:: 图表 5.10‑2 码垛工件配置

**Step3**：在托盘配置栏中点击“配置”进入托盘配置弹窗，设置托盘“前边”，“侧边”和“高度”，接着设置工位和工位过渡点，点击“确认配置”完成托盘信息设置。

.. figure:: robot_peripherals/058.png
   :align: center
   :width: 3in

.. centered:: 图表 5.10‑3 码垛托盘配置

**Step4**：在码垛设备尺寸配置栏中点击“配置”进入码垛设备尺寸配置配置弹窗，设置设备“X”、“Y”、“Z”和“Angle”，点击“确认配置”完成码垛设备尺寸配置信息设置。

.. important:: 
   X、Y、Z为做托盘右上角或者右托盘左上角点相对于机器人基坐标系坐标值的绝对值，Angle为机器人安装时的旋转角度，推荐安装时为0。

.. figure:: robot_peripherals/066.png
   :align: center
   :width: 3in

.. centered:: 图表 5.10‑4 码垛设备尺寸配置

**Step5**：在模式配置栏中点击“配置”进入模式配置弹窗。

   **模式B开启/关闭**：开启：可以切换模式A/B，配置码垛每层模式的B模式；关闭：不可切换模式B，不可配置码垛每层模式的B模式；

   **模式A/B切换**：选择模式A：添加工件为模式A，工件序号为A1，A2...，不可调整工件透明度；选择模式B：添加工件为模式B，工件序号为B1，B2...，此时可以开启/关闭“显示模式A配置”显示模式A工件；

   **显示模式A开启/关闭**：开启：调整模式B工件透明度来查看A/B模式配置效果是否合理，此时只能对模式B工件进行选中、添加、批量添加、删除和删除全部的操作；关闭：无法设置模式B工件透明度；

.. important:: 
   配置工件时，工件之间有碰撞时工件背景颜色变红，此时以上操作无法进行。如需操作，请配置工件为无碰撞。

配置工件时，先设置工件间隔，右侧框框为模拟工件在右托盘的放置方式，可以单个添加也可以批量添加。接着设置码垛层数和各层的模式，点击“确认配置”完成模式信息设置。

.. important:: 
   码垛方向：以右托盘为例，右下角为最远处，从右下角竖向或者横向摆放一排工件，再向上一排横向或竖向摆放工件，以此类推（Web页面已标注码垛方向，请注意查看）。
   
   左托盘依据右托盘模式镜像放置工件。

.. figure:: robot_peripherals/059.png
   :align: center
   :width: 6in

.. centered:: 图表 5.10‑5 码垛模式A配置

.. figure:: robot_peripherals/070.png
   :align: center
   :width: 6in

.. centered:: 图表 5.10‑6 码垛模式B配置

**Step6**：在示教程序生成栏点击“高级配置”进入高级配置弹窗，此时配置“取料抬升高度”、“第一次偏移距离”、“第二次偏移距离”和“吸料等待时间”。

   **取料抬升高度**：用户自定义取料成功后，从抓取点取料成功后抬升的高度；

   **第一/二次偏移距离**：用户自定义配置机器人倾斜堆放至目标点的偏移距离；
   
   **吸料等待时间**：用户自定义配置吸料等待时间，监控吸料后负压到位信号，未到位时重复吸取动作；

   **平滑过渡**：开启平滑过渡按钮，可进行码垛/拆垛PTP平滑时间和LIN平滑半径相关参数配置。
   
   - PTP平滑时间：无平滑过渡时间/等级1(200ms)/等级2(400ms)/等级3(600ms)/等级4(800ms)/等级5(1000ms)
   - LIN平滑半径：无平滑过渡半径/等级1(200mm)/等级2(400mm)/等级3(600mm)/等级4(800mm)/等级5(1000mm)

.. figure:: robot_peripherals/063.png
   :align: center
   :width: 6in

.. centered:: 图表 5.10‑7 码垛高级配置

**Step7**：在示教程序生成栏选择“方式选择”，点击“生成程序”，打开“码垛监控页”，在此页面可以对“生成信息”，“报警信息”和“码垛程序”显示和查看。

.. figure:: robot_peripherals/060.png
   :align: center
   :width: 6in

.. centered:: 图表 5.10‑8 码垛系统监控

**Step8**：码垛运行程序中途报错后，程序停止，用户首先清除报错后，再次选择码垛程序运行，此时会弹出“上次程序中断”弹出框，点击“接续”按钮接续运行，点击“重新开始”按钮重新开始运行程序。

.. figure:: robot_peripherals/064.png
   :align: center
   :width: 6in

.. centered:: 图表 5.10‑9 码垛程序接续

打磨设备配置
---------------

打磨设备配置步骤
~~~~~~~~~~~~~~~~~~~~~~

**Step1**: 进入打磨设备配置页面，配置通讯信息，需要配置IP地址、端口、采样周期和通信协议。配置成功后，下次操作可自动显示。

**Step2**：完成通信配置后，可建立通信，通过加载/卸载打磨设备。

**Step3**：设备功能。可进行设备使能、错误清除和力传感器清零等操作。

**Step4**：参数配置。可设置打磨设备的转速、接触力、伸出距离和控制模式。设置成功后，可在右侧"Polish"状态反馈栏显示相应数据和状态。

.. figure:: robot_peripherals/061.png
   :align: center
   :width: 6in

.. centered:: 图表 5.11-1 打磨状态配置页面
